# IDE Integration

`hx-config` provides utilities for IDE integration, particularly HLS (Haskell Language Server) setup.

## hie.yaml Generation

HLS requires a `hie.yaml` file to locate Haskell source files. hx can generate this automatically.

### Checking Status

```rust
use hx_config::{Project, check_hie_yaml, HieYamlStatus};

let project = Project::load(&root)?;
let status = check_hie_yaml(&project);

match status {
    HieYamlStatus::UpToDate => println!("hie.yaml is current"),
    HieYamlStatus::Outdated => println!("hie.yaml needs update"),
    HieYamlStatus::Missing => println!("hie.yaml not found"),
    HieYamlStatus::Exists => println!("hie.yaml exists (unmanaged)"),
}
```

### HieYamlStatus

```rust
pub enum HieYamlStatus {
    /// No hie.yaml file exists
    Missing,

    /// hie.yaml exists but is out of date
    Outdated,

    /// hie.yaml exists and matches project
    UpToDate,

    /// hie.yaml exists but wasn't created by hx
    Exists,
}
```

### Generating hie.yaml

```rust
use hx_config::{Project, generate_hie_yaml, write_hie_yaml};

let project = Project::load(&root)?;

// Generate content
let content = generate_hie_yaml(&project);

// Write to disk
write_hie_yaml(&project, &project.root.join("hie.yaml"))?;
```

### Generated Format

For a single-package project:

```yaml
# Generated by hx - do not edit
cradle:
  cabal:
    component: "lib:my-package"
```

For a workspace:

```yaml
# Generated by hx - do not edit
cradle:
  cabal:
    - path: "packages/core"
      component: "lib:core"
    - path: "packages/server"
      component: "exe:server"
    - path: "packages/client"
      component: "exe:client"
```

## HLS Compatibility

HLS versions must match GHC versions. hx provides compatibility checking.

### Checking Compatibility

```rust
use hx_config::is_hls_compatible;

let compatible = is_hls_compatible("2.9.0.0", "9.8.2");
if !compatible {
    println!("HLS 2.9.0.0 is not compatible with GHC 9.8.2");
}
```

### Compatibility Matrix

| HLS Version | Supported GHC Versions |
|-------------|------------------------|
| 2.9.0.0 | 9.10.1, 9.8.2, 9.6.6, 9.4.8 |
| 2.8.0.0 | 9.8.2, 9.6.5, 9.4.8, 9.2.8 |
| 2.7.0.0 | 9.8.1, 9.6.4, 9.4.8, 9.2.8 |
| 2.6.0.0 | 9.6.3, 9.4.7, 9.2.8, 9.0.2 |

### Recommended HLS Version

```rust
use hx_config::recommended_hls_for_ghc;

if let Some(hls_version) = recommended_hls_for_ghc("9.8.2") {
    println!("Recommended HLS: {}", hls_version);
}
```

## CLI Commands

### Generate hie.yaml

```bash
hx ide setup
```

### Check IDE Status

```bash
hx doctor
```

Doctor output includes:
- HLS installation status
- HLS/GHC compatibility
- hie.yaml status

## Editor Setup

### VS Code

1. Install "Haskell" extension
2. Run `hx ide setup` in project root
3. Extension auto-detects hie.yaml

### Neovim (nvim-lspconfig)

```lua
require('lspconfig').hls.setup{
    root_dir = function(fname)
        return require('lspconfig.util').root_pattern('hx.toml', 'hie.yaml')(fname)
    end
}
```

### Emacs (lsp-mode)

```elisp
(setq lsp-haskell-server-path "haskell-language-server-wrapper")
```

## Troubleshooting

### HLS Not Finding Modules

1. Check hie.yaml exists: `cat hie.yaml`
2. Regenerate: `hx ide setup`
3. Restart HLS in editor

### HLS Wrong GHC Version

1. Check versions: `hx doctor`
2. Install matching HLS: `ghcup install hls 2.9.0.0`
3. Or pin in hx.toml:
   ```toml
   [toolchain]
   ghc = "9.8.2"
   hls = "2.9.0.0"
   ```

### Workspace Components Not Found

1. Ensure cabal.project lists all packages
2. Regenerate hie.yaml
3. Run `hx build` first to configure Cabal

## Best Practices

1. **Always run `hx ide setup`** after creating a project
2. **Add hie.yaml to .gitignore** if auto-generated
3. **Keep HLS and GHC in sync** via hx.toml
4. **Run `hx doctor`** to diagnose IDE issues
5. **Rebuild after adding packages** to update hie.yaml
